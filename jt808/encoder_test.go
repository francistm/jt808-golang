package jt808

import (
	"github.com/stretchr/testify/assert"
	"testing"
	"time"
)

func TestMarshal0200(t *testing.T) {
	var messagePack MessagePack

	messagePack.PackHeader = PackHeader{
		MessageID:        0x0200,
		TerminalMobileNo: "123456789012",
		SerialNo:         126,
	}

	messagePack.PackBody = Body0200{
		WarnFlag:   1,
		StatusFlag: 2,
		Latitude:   12.222222,
		Longitude:  132.444444,
		Altitude:   40,
		Speed:      6,
		Direction:  0,
		Time:       time.Unix(1539569410, 0), // 2018-10-15 10:10:10 UTC
		ExtraMessage: map[uint8][]byte{
			0x01: {0x00, 0x00, 0x00, 0x64},
			0x02: {0x00, 0x7d},
		},
	}

	b, err := Marshal(&messagePack)

	assert.NoError(t, err)
	assert.Equal(t, []byte{0x7e, 0x02, 0x00, 0x00, 0x26, 0x12, 0x34, 0x56, 0x78, 0x90, 0x12, 0x00, 0x7d, 0x02, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x02, 0x00, 0xba, 0x7f, 0x0e, 0x07, 0xe4, 0xf1, 0x1c, 0x00, 0x28, 0x00, 0x3c, 0x00, 0x00, 0x18, 0x10, 0x15, 0x10, 0x10, 0x10, 0x01, 0x04, 0x00, 0x00, 0x00, 0x64, 0x02, 0x02, 0x00, 0x7d, 0x01, 0x13, 0x7e}, b)
}
